{% extends 'base.html' %}

{% block title %}Resume Analysis{% endblock %}
{% block page_heading %}AI Agent-Based Resume Screening and Evaluation{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">

<style>
    :root {
        --primary-color: #007BFF; /* Bright Blue */
        --primary-light: #66B5FF; /* Lighter Blue */
        --secondary-color: #343A40; /* Dark Grey/Black */
        --accent-color: #FFC107; /* Amber Yellow */
        --success-color: #28A745; /* Green */
        --warning-color: #FFC107; /* Orange/Yellow */
        --info-color: #17A2B8; /* Teal */
        --danger-color: #DC3545; /* Red */
        --bg-gradient-start: #E0F7FA; /* Light Cyan */
        --bg-gradient-end: #B2EBF2; /* Lighter Cyan */
        --card-bg: #FFFFFF;
        --border-color: #E9ECEF;
        --font-color-dark: #343A40;
        --font-color-muted: #6C757D;
        --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
        --shadow-strong: 0 15px 40px rgba(0, 0, 0, 0.25);
    }

    /* Base styles for a clean, modern, and vibrant look */
    body {
        background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
        font-family: 'Inter', sans-serif;
        color: var(--font-color-dark);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-top: 2rem;
        padding-bottom: 2rem;
    }
    .container-main {
        max-width: 1400px;
        width: 100%;
    }
    .page-heading {
        color: var(--secondary-color);
        font-weight: 800;
        margin-bottom: 4rem;
        text-align: center;
        font-size: 3.2rem;
        letter-spacing: -0.07em;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }

    .section-card {
        background-color: var(--card-bg);
        border-radius: 20px;
        padding: 3.5rem;
        box-shadow: var(--shadow-medium);
        margin-bottom: 3rem;
        transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        border-left: 8px solid var(--primary-color); /* Emphasize primary color */
    }

    .section-card:hover {
        transform: translateY(-10px);
        box-shadow: var(--shadow-strong);
    }

    .form-section-title {
        color: var(--secondary-color);
        font-weight: 700;
        margin-bottom: 2.8rem;
        font-size: 2.5rem;
        position: relative;
        padding-bottom: 1rem;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.05);
    }

    .form-section-title::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100px;
        height: 7px;
        background: linear-gradient(90deg, var(--success-color), var(--info-color));
        border-radius: 4px;
    }

    /* Floating label container */
    .form-group-floating {
        position: relative;
        margin-bottom: 2.5rem;
    }

    .form-group-floating .form-control-custom,
    .form-group-floating .form-select-custom {
        padding-top: 1.8rem;
        padding-bottom: 1rem;
        border-radius: 12px; /* Slightly less rounded for a sharper look */
        border: 2px solid var(--border-color);
        background-color: #F8F9FA;
        font-size: 1.1rem;
        color: var(--font-color-dark);
        transition: all 0.3s ease;
    }

    .form-group-floating .form-label {
        position: absolute;
        top: 1.1rem;
        left: 1.25rem;
        transition: all 0.2s ease-out;
        pointer-events: none;
        font-size: 1.05rem;
        color: var(--font-color-muted);
    }

    .form-group-floating .form-control-custom:focus + .form-label,
    .form-group-floating .form-control-custom.has-value + .form-label,
    .form-group-floating .form-select-custom:focus + .form-label,
    .form-group-floating .form-select-custom.has-value + .form-label {
        top: 0.4rem;
        font-size: 0.85rem;
        color: var(--primary-color);
        font-weight: 600;
    }

    .form-control-custom:focus,
    .form-select-custom:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 5px rgba(0, 123, 255, 0.25);
        outline: none;
        background-color: #FFFFFF;
    }

    /* Custom file input styling */
    .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
        margin-bottom: 2.5rem;
    }

    .file-input-wrapper input[type=file] {
        font-size: 100px;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        cursor: pointer;
        width: 100%;
        height: 100%;
    }

    .file-input-wrapper .btn-file-upload {
        display: flex;
        align-items: center;
        width: 100%;
        padding: 1.1rem 1.25rem;
        border-radius: 12px;
        border: 2px solid var(--border-color);
        background-color: #F8F9FA;
        color: var(--font-color-dark);
        text-align: left;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        font-size: 1.1rem;
    }

    .file-input-wrapper .btn-file-upload:hover {
        border-color: var(--primary-color);
        background-color: #E9F5FF;
    }

    .file-input-wrapper .btn-file-upload i {
        margin-right: 1rem;
        color: var(--primary-color);
        font-size: 1.4rem;
    }

    .btn-primary-custom {
        font-weight: 700;
        background-image: linear-gradient(to right, var(--primary-color) 0%, var(--primary-light) 100%);
        border: none;
        padding: 1.4rem 3.5rem;
        border-radius: 15px;
        box-shadow: 0 15px 40px rgba(0, 123, 255, 0.4);
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        color: white;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-size: 1.25rem;
        position: relative;
        overflow: hidden;
        z-index: 1;
    }

    .btn-primary-custom:hover {
        background-image: linear-gradient(to right, var(--primary-light) 0%, var(--primary-color) 100%);
        transform: translateY(-8px);
        box-shadow: 0 22px 60px rgba(0, 123, 255, 0.6);
    }

    .btn-primary-custom::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        opacity: 0;
        transform: translate(-50%, -50%);
        transition: width 0.6s ease-out, height 0.6s ease-out, opacity 0.6s ease-out;
        z-index: -1;
    }

    .btn-primary-custom:active::after {
        width: 300%;
        height: 300%;
        opacity: 1;
        transition: 0s;
    }

    .btn-icon-right {
        margin-left: 18px;
        transition: transform 0.3s ease;
    }

    .btn-primary-custom:hover .btn-icon-right {
        transform: translateX(12px);
    }

    /* PDF Preview Section */
    .pdf-preview-card {
        padding: 0;
        border-radius: 20px;
        box-shadow: var(--shadow-medium);
        border: none;
        overflow: hidden;
        background-color: var(--card-bg);
    }

    .pdf-preview-card .card-body {
        padding: 0;
        overflow: hidden;
        border-radius: 20px;
    }

    .pdf-embed {
        width: 100%;
        height: 750px;
        border-radius: 20px;
        border: none !important;
        outline: none !important;
        box-shadow: none !important;
    }

    .pdf-placeholder {
        text-align: center;
        padding: 3rem;
        height: 100%;
        min-height: 750px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #F0F8FF 0%, #E6F3FF 100%);
        border: 4px dashed var(--info-color);
        border-radius: 20px;
        color: var(--font-color-muted);
    }

    .pdf-placeholder i {
        font-size: 5rem;
        margin-bottom: 2.5rem;
        color: var(--info-color);
        animation: bounceIn 1s ease-out;
    }
    @keyframes bounceIn {
        0%, 20%, 40%, 60%, 80%, 100% {
            transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
        }
        0% { opacity: 0; transform: scale3d(0.3, 0.3, 0.3); }
        20% { transform: scale3d(1.1, 1.1, 1.1); }
        40% { transform: scale3d(0.9, 0.9, 0.9); }
        60% { opacity: 1; transform: scale3d(1.03, 1.03, 1.03); }
        80% { transform: scale3d(0.97, 0.97, 0.97); }
        100% { opacity: 1; transform: scale3d(1, 1, 1); }
    }
    
    .pdf-placeholder .message {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--secondary-color);
        margin-bottom: 1rem;
    }
    .pdf-placeholder .sub-message {
        font-size: 1.1rem;
        color: var(--font-color-muted);
    }
    .pdf-placeholder .error-message {
        color: var(--danger-color);
        font-weight: 700;
        margin-top: 1.8rem;
        font-size: 1.2rem;
    }

    /* Preloader Styles */
    #preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    #preloader.show {
        opacity: 1;
        visibility: visible;
    }

    .preloader-content {
        position: relative;
        z-index: 10000;
        background-color: var(--card-bg);
        border-radius: 25px;
        padding: 5rem;
        text-align: center;
        box-shadow: var(--shadow-strong);
        width: 90%;
        max-width: 650px;
        transform: translateY(30px);
        opacity: 0;
        transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    #preloader.show .preloader-content {
        transform: translateY(0);
        opacity: 1;
    }

    .preloader-title {
        color: var(--secondary-color);
        font-weight: 800;
        margin-bottom: 2rem;
        font-size: 2.8rem;
        letter-spacing: -0.03em;
        text-shadow: 1px 1px 4px rgba(0,0,0,0.08);
    }

    .preloader-text {
        color: var(--font-color-muted);
        font-size: 1.35rem;
        margin-bottom: 4rem;
        min-height: 3.5em;
        opacity: 0.9;
    }

    .progress-container {
        width: 100%;
        height: 45px;
        background-color: var(--border-color);
        border-radius: 22px;
        overflow: hidden;
        box-shadow: inset 0 3px 8px rgba(0,0,0,0.15);
    }

    .progress-bar {
        height: 100%;
        width: 0%;
        background-image: linear-gradient(90deg, var(--success-color), var(--info-color), var(--primary-light));
        transition: width 1s cubic-bezier(0.25, 0.8, 0.25, 1);
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: 800;
        font-size: 1.3rem;
        text-shadow: 1px 1px 5px rgba(0,0,0,0.5);
        position: relative;
        overflow: hidden;
    }
    .progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(-45deg, rgba(255,255,255,0.15) 0, rgba(255,255,255,0.15) 12px, transparent 12px, transparent 24px);
        animation: progress-stripes 2.5s linear infinite;
    }
    @keyframes progress-stripes {
        from { background-position: 0 0; }
        to { background-position: 48px 0; }
    }


    /* Results section styling */
    .results-section {
        margin-top: 5rem;
        padding: 4.5rem;
        background-color: var(--card-bg);
        border-radius: 25px;
        box-shadow: var(--shadow-medium);
        border-top: 10px solid var(--primary-color);
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 1s cubic-bezier(0.25, 0.8, 0.25, 1), transform 1s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .results-section.show {
        opacity: 1;
        transform: translateY(0);
    }

    .results-section h2, .results-section h4 {
        color: var(--secondary-color);
        font-weight: 700;
        margin-top: 4rem;
        margin-bottom: 3rem;
        position: relative;
        font-size: 2.5rem;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.05);
    }

    .results-section h4::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 90px;
        height: 7px;
        background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        border-radius: 3px;
    }
    
    .summary-box {
        background-color: var(--card-bg);
        border-radius: 15px;
        padding: 2.8rem;
        box-shadow: var(--shadow-light);
        border-left: 6px solid var(--primary-color);
        transition: all 0.4s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .summary-box:hover {
        border-left-color: var(--accent-color);
        box-shadow: var(--shadow-medium);
        transform: translateY(-5px);
    }
    .summary-box h5 {
        font-weight: 700;
        color: var(--secondary-color);
        margin-bottom: 2rem;
        font-size: 1.6rem;
        display: flex;
        align-items: center;
    }
    .summary-box h5 i {
        margin-right: 1.2rem;
        font-size: 1.8rem;
        color: var(--primary-color);
    }
    .summary-box p {
        flex-grow: 1;
        font-size: 1.15rem;
        color: var(--font-color-dark);
    }


    /* New summary tiles styling */
    .summary-tile {
        background-color: var(--card-bg);
        border-radius: 15px;
        padding: 2.5rem;
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
        height: 100%;
        display: flex;
        flex-direction: column;
        transition: all 0.4s ease;
    }
    
    .summary-tile:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-medium);
        border-color: var(--primary-light);
    }

    .summary-tile h6 {
        font-weight: 600;
        color: var(--secondary-color);
        margin-bottom: 1.5rem;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
    }

    .summary-tile h6 i {
        font-size: 1.6rem;
        margin-right: 1.2rem;
        color: var(--primary-color);
    }
    
    .summary-tile p {
        color: var(--font-color-dark);
        font-weight: 700;
        font-size: 1.6rem;
        margin-bottom: 0;
        flex-grow: 1;
        display: flex;
        align-items: flex-end;
    }

    /* Analysis tiles styling (for detailed summary) */
    .analysis-tile {
        background-color: var(--card-bg);
        border-radius: 15px;
        padding: 2.8rem;
        box-shadow: var(--shadow-light);
        border-top: 6px solid var(--primary-color);
        transition: all 0.4s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .analysis-tile:hover {
        border-top-color: var(--success-color);
        box-shadow: var(--shadow-medium);
        transform: translateY(-5px);
    }

    .analysis-tile h6 {
        color: var(--secondary-color);
        font-weight: 700;
        font-size: 1.5rem;
        margin-bottom: 1.8rem;
        display: flex;
        align-items: center;
    }

    .analysis-tile h6 i {
        font-size: 1.6rem;
        margin-right: 1.2rem;
    }

    .analysis-tile p {
        color: var(--font-color-dark);
        line-height: 1.9;
        flex-grow: 1;
    }

    .fitment-verdict {
        font-size: 3.5rem;
        font-weight: 800;
        letter-spacing: 2.5px;
        text-transform: uppercase;
        animation: fadeInScale 1.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        text-shadow: 3px 3px 8px rgba(0,0,0,0.15);
    }
    
    .fitment-verdict.selected { color: var(--success-color); }
    .fitment-verdict.marginal { color: var(--warning-color); }
    .fitment-verdict.rejected { color: var(--danger-color); }
    
    @keyframes fadeInScale {
        from { opacity: 0; transform: scale(0.7); }
        to { opacity: 1; transform: scale(1); }
    }

    .table-responsive {
        margin-top: 3.5rem;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
    }

    .table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
        background-color: var(--card-bg);
    }

    .table thead th {
        background-color: var(--secondary-color);
        color: white;
        font-weight: 600;
        border: none;
        padding: 1.8rem 1.8rem;
        text-transform: uppercase;
        letter-spacing: 1.2px;
        font-size: 1.05rem;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.15);
    }

    .table thead th:first-child { border-top-left-radius: 15px; }
    .table thead th:last-child { border-top-right-radius: 15px; }

    .table tbody tr {
        transition: all 0.4s ease;
    }
    
    .table tbody tr:not(:last-child) {
        border-bottom: 1px solid var(--border-color);
    }

    .table tbody tr:hover {
        background-color: #F8F9FA;
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: #F8F9FA;
    }

    .table-sm th, .table-sm td {
        padding: 1.6rem;
        border-color: var(--border-color);
        color: var(--font-color-dark);
        vertical-align: middle;
        font-size: 1.05rem;
    }

    .questions-list {
        list-style-type: none;
        padding-left: 0;
    }

    .questions-list li {
        margin-bottom: 1.8rem;
        line-height: 2;
        padding: 1.8rem 2.2rem 1.8rem 4.5rem;
        position: relative;
        background-color: var(--card-bg);
        border-radius: 15px;
        box-shadow: var(--shadow-light);
        color: var(--font-color-dark);
        font-size: 1.15rem;
        transition: all 0.4s ease;
        border-left: 6px solid var(--info-color);
    }

    .questions-list li:hover {
        transform: translateX(10px);
        box-shadow: var(--shadow-medium);
        border-left-color: var(--primary-light);
    }

    .questions-list li::before {
        content: "\f058";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        color: var(--success-color);
        position: absolute;
        left: 1.8rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.8rem;
    }
    
    .recommendation-box, .insights-box {
        background-color: var(--card-bg);
        padding: 2.8rem;
        border-radius: 15px;
        border: 1px solid var(--border-color);
        margin-bottom: 2.5rem;
        box-shadow: var(--shadow-light);
        height: 100%;
        display: flex;
        flex-direction: column;
        transition: all 0.4s ease;
    }
    .recommendation-box:hover, .insights-box:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-medium);
    }

    .recommendation-box h6, .insights-box h6 {
        font-weight: 700;
        color: var(--secondary-color);
        border-bottom: 4px solid var(--primary-color);
        padding-bottom: 1.2rem;
        margin-bottom: 2.2rem;
        font-size: 1.6rem;
        display: flex;
        align-items: center;
    }
    .recommendation-box h6 i, .insights-box h6 i {
        margin-right: 1.2rem;
        font-size: 1.8rem;
        color: var(--primary-color);
    }
    .recommendation-box p, .insights-box p {
        font-size: 1.15rem;
        color: var(--font-color-dark);
    }
    .recommendation-box ul, .insights-box ul {
        list-style-type: disc;
        padding-left: 1.8rem;
        margin-top: 1.2rem;
    }
    .recommendation-box ul li, .insights-box ul li {
        margin-bottom: 0.7rem;
        color: var(--font-color-dark);
    }


    .project-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 2.8rem;
        box-shadow: var(--shadow-light);
        margin-bottom: 2.8rem;
        transition: all 0.4s ease;
    }

    .project-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-medium);
    }

    .project-card-header {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 2rem;
        margin-bottom: 1.8rem;
        display: flex;
        align-items: center;
    }
    
    .project-card-header::before {
        content: "\f0a1";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        color: var(--warning-color);
        margin-right: 1.5rem;
        font-size: 1.8rem;
    }
    .project-card p {
        font-size: 1.15rem;
        color: var(--font-color-dark);
    }
    .project-card ul {
        list-style-type: disc;
        padding-left: 2rem;
        margin-top: 1.5rem;
    }
    .project-card ul li {
        margin-bottom: 0.7rem;
        color: var(--font-color-dark);
    }
    
    .no-results-message {
        text-align: center;
        padding: 6rem;
        background-color: var(--card-bg);
        border-radius: 20px;
        border: 3px dashed var(--info-color);
        color: var(--font-color-muted);
        margin-top: 3.5rem;
        font-size: 1.4rem;
        box-shadow: var(--shadow-light);
    }
    
    .no-results-message i {
        font-size: 6rem;
        color: var(--info-color);
        margin-bottom: 2.5rem;
        animation: bounceIn 1s ease-out;
    }

    /* Fade-in animation for results items */
    .fade-in-item {
        opacity: 0;
        transform: translateY(30px);
        animation: fadeInSlideUp 0.8s ease-out forwards;
    }

    @keyframes fadeInSlideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive adjustments */
    @media (max-width: 991px) {
        .page-heading {
            font-size: 2.5rem;
            margin-bottom: 2.5rem;
        }
        .section-card {
            padding: 3rem;
            border-radius: 18px;
        }
        .form-section-title {
            font-size: 2.2rem;
            margin-bottom: 2.5rem;
        }
        .form-section-title::after {
            width: 80px;
            height: 5px;
        }
        .pdf-embed, .pdf-placeholder {
            min-height: 550px;
            height: 550px;
        }
        .results-section {
            padding: 3.5rem;
            border-radius: 20px;
        }
        .results-section h2, .results-section h4 {
            font-size: 2.2rem;
            margin-top: 3rem;
            margin-bottom: 2.5rem;
        }
        .results-section h4::after {
            width: 70px;
            height: 5px;
        }
        .summary-tile, .analysis-tile, .summary-box, .recommendation-box, .insights-box, .project-card {
            padding: 2.2rem;
            border-radius: 15px;
        }
        .summary-tile p {
            font-size: 1.3rem;
        }
        .fitment-verdict {
            font-size: 3rem;
        }
        .preloader-content {
            padding: 4rem;
            max-width: 90%;
        }
        .preloader-title {
            font-size: 2.4rem;
        }
        .preloader-text {
            font-size: 1.2rem;
        }
        .progress-container {
            height: 35px;
        }
        .table thead th, .table-sm th, .table-sm td {
            padding: 1.5rem;
            font-size: 1rem;
        }
        .questions-list li {
            padding: 1.5rem 1.8rem 1.5rem 4rem;
            font-size: 1.1rem;
            border-radius: 15px;
        }
        .questions-list li::before {
            left: 1.5rem;
            font-size: 1.6rem;
        }
        .no-results-message {
            padding: 5rem;
            font-size: 1.2rem;
            border-radius: 20px;
        }
        .no-results-message i {
            font-size: 6rem;
            margin-bottom: 2rem;
        }
    }

    @media (max-width: 767px) {
        .page-heading {
            font-size: 2rem;
            margin-bottom: 2rem;
        }
        .section-card {
            padding: 2.5rem;
            border-radius: 15px;
        }
        .form-section-title {
            font-size: 2rem;
            margin-bottom: 2rem;
        }
        .form-section-title::after {
            width: 60px;
            height: 4px;
        }
        .pdf-embed, .pdf-placeholder {
            min-height: 400px;
            height: 400px;
        }
        .results-section {
            padding: 2.5rem;
            border-radius: 18px;
        }
        .results-section h2, .results-section h4 {
            font-size: 2rem;
            margin-top: 2.5rem;
            margin-bottom: 2rem;
        }
        .results-section h4::after {
            width: 60px;
            height: 4px;
        }
        .summary-tile, .analysis-tile, .summary-box, .recommendation-box, .insights-box, .project-card {
            padding: 1.8rem;
            border-radius: 12px;
        }
        .summary-tile p {
            font-size: 1.1rem;
        }
        .fitment-verdict {
            font-size: 2.5rem;
        }
        .preloader-content {
            padding: 3rem;
        }
        .preloader-title {
            font-size: 1.8rem;
        }
        .preloader-text {
            font-size: 1rem;
            margin-bottom: 2.5rem;
        }
        .progress-container {
            height: 30px;
        }
        .btn-primary-custom {
            padding: 1rem 2.2rem;
            font-size: 1.05rem;
            letter-spacing: 1.2px;
            border-radius: 12px;
        }
        .btn-icon-right {
            margin-left: 10px;
        }
        .table-responsive {
            margin-top: 2.5rem;
            border-radius: 15px;
        }
        .table thead th, .table-sm th, .table-sm td {
            padding: 1rem;
            font-size: 0.9rem;
        }
        .questions-list li {
            padding: 1rem 1.2rem 1rem 3rem;
            font-size: 0.95rem;
            border-radius: 12px;
        }
        .questions-list li::before {
            left: 1rem;
            font-size: 1.2rem;
        }
        .no-results-message {
            padding: 4rem;
            font-size: 1.1rem;
            border-radius: 15px;
        }
        .no-results-message i {
            font-size: 5rem;
            margin-bottom: 2rem;
        }
    }
</style>

<div class="container container-main">
    <h1 class="page-heading">AI Agent-Based Resume Screening and Evaluation</h1>
    <div class="row g-5">
        <div class="col-lg-5 col-md-12">
            <div class="section-card">
                <h2 class="form-section-title">Candidate Details:</h2>
                <form method="post" enctype="multipart/form-data" id="resumeForm" class="row g-3 mt-3">
                    {% csrf_token %}

                    <div class="col-12">
                        <label for="resumeInput" class="form-label">
                            <i class="fas fa-file-upload me-2 text-primary"></i> Upload a PDF Resume
                        </label>
                        <div class="file-input-wrapper">
                            <input type="file" id="resumeInput" name="{{ form.resume_pdf.name }}" accept="application/pdf">
                            <div class="btn-file-upload">
                                <i class="fas fa-file-pdf"></i> <span id="resumeFileName">No file chosen</span>
                            </div>
                        </div>
                        {% if form.resume_pdf.errors %}
                            <div class="form-error-message text-danger mt-1">{{ form.resume_pdf.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted d-block mt-1">{{ form.resume_pdf.help_text }}</small>
                    </div>

                    <div class="col-12">
                        <label for="jobDescriptionInput" class="form-label">
                            <i class="fas fa-file-alt me-2 text-primary"></i> Upload Job Description (Optional)
                        </label>
                        <div class="file-input-wrapper">
                            <input type="file" id="jobDescriptionInput" name="{{ form.job_description.name }}" accept=".pdf,.doc,.docx,.txt">
                            <div class="btn-file-upload">
                                <i class="fas fa-file-word"></i> <span id="jobDescriptionFileName">No file chosen</span>
                            </div>
                        </div>
                        {% if form.job_description.errors %}
                            <div class="form-error-message text-danger mt-1">{{ form.job_description.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted d-block mt-1">Accepts PDF, DOCX, or plain text files.</small>
                    </div>

                    <div class="col-12 form-group-floating">
                        {{ form.job_role }}
                        <label for="{{ form.job_role.id_for_label }}" class="form-label">
                            <i class="fas fa-briefcase me-2"></i> {{ form.job_role.label }}
                        </label>
                        {% if form.job_role.errors %}
                            <div class="form-error-message text-danger mt-1">{{ form.job_role.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="col-12 form-group-floating">
                        {{ form.target_experience_type }}
                        <label for="{{ form.target_experience_type.id_for_label }}" class="form-label">
                            <i class="fas fa-star me-2"></i> {{ form.target_experience_type.label }}
                        </label>
                        {% if form.target_experience_type.errors %}
                            <div class="form-error-message text-danger mt-1" >{{ form.target_experience_type.errors }}</div>
                        {% endif %}
                    </div>

                    <div id="experience_fields" class="row g-4 px-3" style="display: none;">
                        <div class="col-md-6 col-sm-12 form-group-floating">
                            {{ form.min_years_required }}
                            <label for="{{ form.min_years_required.id_for_label }}" class="form-label">
                                <i class="fas fa-sort-numeric-up me-2"></i> Min. Years
                            </label>
                            {% if form.min_years_required.errors %}
                                <div class="form-error-message text-danger mt-1">{{ form.min_years_required.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 col-sm-12 form-group-floating" id="max_years_div">
                            {{ form.max_years_required }}
                            <label for="{{ form.max_years_required.id_for_label }}" class="form-label">
                                <i class="fas fa-sort-numeric-down me-2"></i> Max. Years
                            </label>
                            {% if form.max_years_required.errors %}
                                <div class="form-error-message text-danger mt-1">{{ form.max_years_required.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="col-12 mt-4">
                        <button type="submit" class="btn btn-primary-custom btn-lg w-100">
                            <i class="fas fa-magic me-2"></i> Analyse Resume
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <div class="col-lg-7 col-md-12">
            <div class="section-card pdf-preview-card">
                <div class="card-body position-relative">

                    <!-- PDF Embed -->
                    <embed id="pdfEmbed"
                        class="pdf-embed"
                        type="application/pdf"
                        style="display: {% if resume_url %}block{% else %}none{% endif %};"
                        {% if resume_url %}src="{{ resume_url }}#toolbar=0&navpanes=0"{% endif %}>

                    <!-- Placeholder -->
                    <div class="pdf-placeholder" id="pdfPlaceholder"
                            style="display: {% if resume_url %}none{% else %}flex{% endif %};">
                        <i class="fas fa-file-pdf"></i>
                        <p class="message">Upload a PDF Resume to Preview</p>
                        <p class="sub-message">The AI analysis will begin shortly after.</p>
                        <p class="error-message" id="pdfErrorMessage" style="display: none;"></p>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Preloader HTML -->
    <div id="preloader">
        <div class="preloader-overlay"></div>
        <div class="preloader-content">
            <h3 class="preloader-title">Analyzing Resume...</h3>
            <p class="preloader-text" id="preloaderMessage">Initializing AI agents...</p>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <span id="progressText">0%</span>
                </div>
            </div>
        </div>
    </div>

    {% if analysis_result %}
        <div class="results-section show" data-analysis-loaded="true">
            <h2 class="form-section-title">AI Analysis for <span class="text-primary">{{ analysis_result.full_name|default:"Candidate" }}</span></h2>
            
            <div class="row g-4 mb-4">
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-briefcase me-2"></i> Job Role</h6>
                        <p>{{ form.job_role.value|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-phone me-2"></i> Contact Number</h6>
                        <p>{{ analysis_result.phone_no|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-building me-2"></i> Current Company</h6>
                        <p>{{ analysis_result.current_company_name|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-map-marker-alt me-2"></i> Company Address</h6>
                        <p>{{ analysis_result.current_company_address|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-chart-line me-2"></i> Overall Experience</h6>
                        <p>{{ analysis_result.overall_experience|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-thumbs-up me-2"></i> Hiring Recommendation</h6>
                        <p class="
                            {% if analysis_result.hiring_recommendation == 'Hire' or analysis_result.hiring_recommendation == 'Strong Hire' %}text-success
                            {% elif analysis_result.hiring_recommendation == 'Reject' %}text-danger
                            {% else %}text-warning{% endif %}">
                            {{ analysis_result.hiring_recommendation|default:"N/A" }}
                        </p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-percentage me-2"></i> Experience Match</h6>
                        <p class="text-success">{{ analysis_result.experience_match|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="summary-tile fade-in-item">
                        <h6><i class="fas fa-dollar-sign me-2"></i> Suggested Salary</h6>
                        <p>{{ analysis_result.suggested_salary_range|default:"N/A" }}</p>
                    </div>
                </div>
            </div>
            
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="summary-box fade-in-item">
                        <h5 class="text-primary"><i class="fas fa-shield-alt me-2"></i> Candidate Fitment Verdict</h5>
                        <p class="fitment-verdict mt-3 
                                {% if analysis_result.fitment_verdict == 'SELECTED' %}selected
                                {% elif analysis_result.fitment_verdict == 'MARGINALLY FIT' %}marginal
                                {% else %}rejected{% endif %}">
                            {{ analysis_result.fitment_verdict|default:"N/A" }}
                        </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="summary-box fade-in-item">
                        <h5 class="text-primary"><i class="fas fa-sitemap me-2"></i> Strategic Alignment</h5>
                        <p>{{ analysis_result.candidate_fitment_analysis.strategic_alignment|default:"N/A" }}</p>
                    </div>
                </div>
            </div>

            <h4 class="form-section-title mt-5">Core Competency Assessment</h4>
            <div class="row g-4 mb-4">
                {% if analysis_result.core_competencies_assessment %}
                    {% for competency in analysis_result.core_competencies_assessment %}
                        <div class="col-md-3 col-sm-6">
                            <div class="summary-tile fade-in-item">
                                <h6><i class="fas fa-star me-2"></i> {{ competency.competency|default:"N/A" }}</h6>
                                <p class="
                                    {% if competency.level == 'Excellent' or competency.level == 'Advanced' %}text-success
                                    {% elif competency.level == 'Proficient' %}text-primary
                                    {% elif competency.level == 'Intermediate' %}text-warning
                                    {% else %}text-muted{% endif %}
                                ">
                                    {{ competency.level|default:"N/A" }}
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="col-12">
                        <div class="summary-box text-center text-muted fade-in-item">
                            <p>No core competency assessment data available.</p>
                        </div>
                    </div>
                {% endif %}
            </div>

            <h4 class="form-section-title mt-5">Deep-Dive Scoring Matrix</h4>
            <div class="table-responsive fade-in-item">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Evaluation Dimension</th>
                            <th>Weight</th>
                            <th>Score</th>
                            <th>Evidence-Based Justification</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in analysis_result.scoring_matrix %}
                            <tr>
                                <td class="fw-bold">{{ item.dimension|default:"N/A" }}</td>
                                <td>{{ item.weight|default:"N/A" }}</td>
                                <td>{{ item.score|default:"N/A" }}</td>
                                <td>{{ item.justification|default:"N/A" }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No scoring matrix data available.</td>
                            </tr>
                        {% endfor %}
                        <tr>
                            <td class="fw-bold">âž¤ Aggregate Score</td>
                            <td>100%</td>
                            <td class="fw-bold">{{ analysis_result.aggregate_score|default:"N/A" }}</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 class="form-section-title mt-5">Detailed Analysis Summary for <span class="text-primary">{{ analysis_result.full_name|default:"the Candidate" }}</span></h4>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="analysis-tile fade-in-item">
                        <h6><i class="fas fa-user-circle me-2 text-primary"></i> Candidate Overview</h6>
                        <p>{{ analysis_result.analysis_summary.candidate_overview|default:"No candidate overview provided." }}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="analysis-tile fade-in-item">
                        <h6><i class="fas fa-chart-line me-2 text-success"></i> Quantifiable Impact</h6>
                        <p>{{ analysis_result.candidate_fitment_analysis.quantifiable_impact|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="analysis-tile fade-in-item">
                        <h6><i class="fas fa-exclamation-triangle me-2 text-danger"></i> Potential Gaps & Risks</h6>
                        <p>{{ analysis_result.candidate_fitment_analysis.potential_gaps_risks|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analysis-tile fade-in-item">
                        <h6><i class="fas fa-briefcase me-2 text-info"></i> Comparable Experience</h6>
                        <p>{{ analysis_result.candidate_fitment_analysis.comparable_experience_analysis|default:"N/A" }}</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analysis-tile fade-in-item">
                        <h6><i class="fas fa-check-circle me-2 text-secondary"></i> Conclusion</h6>
                        <p>{{ analysis_result.analysis_summary.conclusion|default:"No conclusion provided." }}</p>
                    </div>
                </div>
            </div>

            <h4 class="form-section-title mt-5">Technical Skills & Projects</h4>
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="summary-box fade-in-item">
                        <h6 class="text-primary">Technical Prowess</h6>
                        <ul>
                            {% for skill_category, skills in analysis_result.analysis_summary.technical_prowess.items %}
                                <li><strong>{{ skill_category }}:</strong> {{ skills|join:", " }}</li>
                            {% empty %}
                                <li>No technical skills identified.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="summary-box fade-in-item">
                        <h6 class="text-primary">Education & Certifications</h6>
                        <ul>
                            {% for edu in analysis_result.analysis_summary.education_certifications.education %}
                                <li>{{ edu }}</li>
                            {% empty %}
                                <li>No education details provided.</li>
                            {% endfor %}
                            {% for cert in analysis_result.analysis_summary.education_certifications.certifications %}
                                <li>{{ cert }}</li>
                            {% empty %}
                                <li>No certifications provided.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            
            <h4 class="form-section-title mt-5">Project Impact & Achievements</h4>
            {% for project in analysis_result.analysis_summary.project_impact %}
                <div class="project-card fade-in-item">
                    <div class="project-card-header">{{ project.title|default:"Project Title N/A" }}</div>
                    <p><strong>Company:</strong> {{ project.company|default:"N/A" }}</p>
                    <p><strong>Role:</strong> {{ project.role|default:"N/A" }}</p>
                    <p><strong>Achievements:</strong></p>
                    <ul>
                        {% for achievement in project.achievements %}
                            <li>{{ achievement }}</li>
                        {% empty %}
                            <li>No specific achievements listed.</li>
                        {% endfor %}
                    </ul>
                </div>
            {% empty %}
                <div class="summary-box fade-in-item">
                    <p class="text-muted">No project impact or achievements found.</p>
                </div>
            {% endfor %}

            <div class="row g-4 mt-5">
                <div class="col-md-6">
                    <div class="recommendation-box fade-in-item">
                        <h6><i class="fas fa-tasks me-2"></i> Bench & Alternative Roles</h6>
                        <p><strong>Retain for future consideration?</strong> {{ analysis_result.bench_recommendation.retain|default:"N/A" }}</p>
                        <p><strong>Ideal Future Role(s):</strong> {{ analysis_result.bench_recommendation.ideal_future_roles|join:", "|default:"N/A" }}</p>
                        <p><strong>Justification:</strong> {{ analysis_result.bench_recommendation.justification|default:"N/A" }}</p>
                        <h6 class="mt-4"><i class="fas fa-exchange-alt me-2"></i> Alternative Role Recommendations</h6>
                        <ul>
                            {% for role in analysis_result.alternative_role_recommendations %}
                                <li><strong>{{ role.role|default:"N/A" }}:</strong> {{ role.explanation|default:"N/A" }}</li>
                            {% empty %}
                                <li>No alternative roles suggested.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="insights-box fade-in-item">
                        <h6><i class="fas fa-lightbulb me-2"></i> Automated Recruiter Insights</h6>
                        <p><strong>Red Flag Detection:</strong> {{ analysis_result.automated_recruiter_insights.red_flag_detection|default:"None" }}</p>
                        <p><strong>Growth Indicators:</strong> {{ analysis_result.automated_recruiter_insights.growth_indicators|default:"None" }}</p>
                        <p><strong>Cross-Industry Potential:</strong> {{ analysis_result.automated_recruiter_insights.cross_industry_potential|default:"None" }}</p>
                    </div>
                </div>
            </div>

            <h4 class="form-section-title mt-5">Suggested Interview Questions for <span class="text-primary">{{ analysis_result.full_name|default:"the Candidate" }}</span></h4>
            <ul class="questions-list">
                {% for question in analysis_result.interview_questions %}
                    <li class="fade-in-item">{{ question }}</li>
                {% empty %}
                    <li class="text-muted fade-in-item">No specific questions were generated.</li>
                {% endfor %}
            </ul>
              <div class="d-flex justify-content-end mt-4 pt-3 border-top fade-in-item">
                    {% if analysis_result.id %} {# Ensure candidate ID exists before linking #}
                        <a href="{% url 'interview_status' candidate_id=analysis_result.id %}" class="btn btn-primary-custom btn-lg">
                            Proceed to Call Interview <i class="fas fa-arrow-right btn-icon-right"></i>
                        </a>
                    {% else %}
                        <button type="button" class="btn btn-secondary btn-lg" disabled>
                            Proceed to Call Interview (No Candidate ID) <i class="fas fa-arrow-right btn-icon-right"></i>
                        </button>
                    {% endif %}
                </div>
        </div>
    {% else %}
        <div class="no-results-message fade-in-item">
            <i class="fas fa-robot"></i>
            <p>Upload a resume and job details to see AI-powered analysis here!</p>
            <p class="text-muted">The results will appear after a successful analysis.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const experienceTypeSelect = document.getElementById('{{ form.target_experience_type.id_for_label }}');
        const experienceFieldsDiv = document.getElementById('experience_fields');
        const minYearsInput = document.getElementById('{{ form.min_years_required.id_for_label }}');
        const maxYearsDiv = document.getElementById('max_years_div');
        const maxYearsInput = document.getElementById('{{ form.max_years_required.id_for_label }}');

        function toggleExperienceFields() {
            if (!experienceTypeSelect || !experienceFieldsDiv || !minYearsInput || !maxYearsDiv || !maxYearsInput) {
                return;
            }

            const selectedValue = experienceTypeSelect.value;
            experienceFieldsDiv.style.display = 'none';

            minYearsInput.setAttribute('disabled', 'disabled');
            minYearsInput.value = '';
            maxYearsInput.setAttribute('disabled', 'disabled');
            maxYearsInput.value = '';

            if (selectedValue === 'Specific Range (Years)' || selectedValue === 'Minimum Years Required') {
                experienceFieldsDiv.style.display = 'flex';
                minYearsInput.removeAttribute('disabled');

                if (selectedValue === 'Specific Range (Years)') {
                    maxYearsDiv.style.display = 'block';
                    maxYearsInput.removeAttribute('disabled');
                } else {
                    maxYearsDiv.style.display = 'none';
                }
            }
        }

        if (experienceTypeSelect) {
            toggleExperienceFields();
            experienceTypeSelect.addEventListener('change', toggleExperienceFields);
        }

        const resumeFileInput = document.getElementById('resumeInput');
        const resumeFileNameSpan = document.getElementById('resumeFileName');
        const jobDescriptionFileInput = document.getElementById('jobDescriptionInput');
        const jobDescriptionFileNameSpan = document.getElementById('jobDescriptionFileName');
        const pdfEmbed = document.getElementById('pdfEmbed');
        const pdfPlaceholder = document.getElementById('pdfPlaceholder');
        const pdfErrorMessage = document.getElementById('pdfErrorMessage');

        // Initialize PDF viewer state
        if (pdfEmbed && pdfEmbed.src && pdfEmbed.src !== window.location.href + '#toolbar=0&navpanes=0') { // Check if src is actually set
            pdfEmbed.style.display = 'block';
            if (pdfPlaceholder) pdfPlaceholder.style.display = 'none';
        } else {
            if (pdfEmbed) pdfEmbed.style.display = 'none';
            if (pdfPlaceholder) pdfPlaceholder.style.display = 'flex';
        }

        // Handle resume file input change
        if (resumeFileInput) {
            resumeFileInput.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    resumeFileNameSpan.textContent = file.name;
                    if (file.type === 'application/pdf') {
                        const fileURL = URL.createObjectURL(file);
                        pdfEmbed.src = fileURL + '#toolbar=0&navpanes=0';
                        pdfEmbed.style.display = 'block';
                        pdfPlaceholder.style.display = 'none';
                        pdfErrorMessage.style.display = 'none'; // Hide error message
                    } else {
                        pdfEmbed.src = '';
                        pdfEmbed.style.display = 'none';
                        pdfPlaceholder.style.display = 'flex';
                        pdfErrorMessage.textContent = "Please upload a valid PDF file for resume preview.";
                        pdfErrorMessage.style.display = 'block'; // Show error message
                    }
                } else {
                    resumeFileNameSpan.textContent = 'No file chosen';
                    pdfEmbed.src = '';
                    pdfEmbed.style.display = 'none';
                    pdfPlaceholder.style.display = 'flex';
                    pdfErrorMessage.style.display = 'none';
                }
            });
        }

        // Handle job description file input change
        if (jobDescriptionFileInput) {
            jobDescriptionFileInput.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    jobDescriptionFileNameSpan.textContent = file.name;
                } else {
                    jobDescriptionFileNameSpan.textContent = 'No file chosen';
                }
            });
        }


        // Preloader Logic
        const resumeForm = document.getElementById('resumeForm');
        const preloader = document.getElementById('preloader');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const preloaderMessage = document.getElementById('preloaderMessage');
        const resultsSection = document.querySelector('.results-section');

        const preloaderMessages = [
            "Initializing AI agents...",
            "Extracting key information from your resume...",
            "Analyzing skills and experience...",
            "Comparing with job description requirements...",
            "Generating comprehensive fitment analysis...",
            "Calculating strategic alignment...",
            "Detecting potential red flags and growth indicators...",
            "Crafting personalized interview questions...",
            "Finalizing report for presentation..."
        ];
        let messageIndex = 0;
        let messageInterval;

        function startMessageCycle() {
            messageIndex = 0;
            preloaderMessage.textContent = preloaderMessages[messageIndex];
            messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % preloaderMessages.length;
                preloaderMessage.textContent = preloaderMessages[messageIndex];
            }, 2000); // Change message every 2 seconds
        }

        function stopMessageCycle() {
            clearInterval(messageInterval);
        }

        if (resumeForm) {
            resumeForm.addEventListener('submit', function(event) {
                // Check if a PDF is selected for resume, otherwise let the form validation handle it
                if (!resumeFileInput.files.length || resumeFileInput.files[0].type !== 'application/pdf') {
                    // Form validation for required fields will prevent submission if resume is not selected
                    // The custom error message for PDF type is already handled by the change listener
                    return; 
                }
                
                // Prevent the form from submitting immediately
                event.preventDefault();
                
                // Show the preloader with animation
                preloader.classList.add('show');
                startMessageCycle();
                
                let currentProgress = 0;
                const form = this;

                // Simulate progress
                const progressInterval = setInterval(function() {
                    currentProgress += 10;
                    if (currentProgress <= 90) { 
                        progressBar.style.width = currentProgress + '%';
                        progressText.textContent = currentProgress + '%';
                    } else {
                        clearInterval(progressInterval);
                        stopMessageCycle();
                        // Once the simulated progress is done, submit the form
                        form.submit(); 
                    }
                }, 500); // Update progress every 500ms
            });
        }

        // Fade in results section on load if analysis_result exists
        if (resultsSection && resultsSection.dataset.analysisLoaded) {
            resultsSection.classList.add('show');
            // Staggered fade-in for results section items
            const fadeInItems = document.querySelectorAll('.results-section .fade-in-item');
            fadeInItems.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`; // Stagger by 100ms
                item.classList.add('fade-in-animation');
            });
        }

        // Add 'has-value' class to form-group-floating when input is focused or has value
        document.querySelectorAll('.form-group-floating .form-control-custom, .form-group-floating .form-select-custom').forEach(input => {
            const updateFloatingLabel = () => {
                if (input.value || input === document.activeElement || (input.tagName === 'SELECT' && input.value !== '')) {
                    input.classList.add('has-value');
                } else {
                    input.classList.remove('has-value');
                }
            };

            input.addEventListener('focus', updateFloatingLabel);
            input.addEventListener('blur', updateFloatingLabel);
            input.addEventListener('change', updateFloatingLabel); // For select elements
            updateFloatingLabel(); // Initial check on load
        });
    });
</script>

{% endblock %}
