{% extends 'base.html' %}

{% block title %}Candidate Records{% endblock %}
{% block page_heading %}Candidate Records{% endblock %}

{% block content %}
    <div class="card p-4">
        {# STATIC DATA FOR DEMONSTRATION #}
        {# In a real application, 'candidates' would come from your Django view context. #}
        {# For now, we're simulating it directly in the template. #}

        
        {% if candidates %}
            <div class="table-responsive">
                {# Add an ID to your table for DataTables initialization #}
                <table id="candidateRecordsTable" class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Job Role</th>
                            <th>Overall Exp.</th>
                            <th>AI Rec.</th>
                            <th>Suggested Salary</th>
                            <th>Final Decision</th>
                            <th>Final Salary</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for candidate in candidates %}
                            <tr>
                                <td>{{ candidate.full_name }}</td>
                                <td>{{ candidate.job_role }}</td>
                                <td>{{ candidate.overall_experience }}</td>
                                <td class="
                                    {% if candidate.hiring_recommendation == 'Hire' or candidate.hiring_recommendation == 'Strong Hire' %}text-success{% elif candidate.hiring_recommendation == 'Reject' %}text-danger{% else %}text-warning{% endif %}
                                ">{{ candidate.hiring_recommendation }}</td>
                                <td>{{ candidate.suggested_salary_range }}</td>
                                <td>
                                    <span class="
                                        {% if candidate.final_decision == 'Selected' %}text-success{% elif candidate.final_decision == 'Rejected' %}text-danger{% elif candidate.final_decision == 'Interview Scheduled' %}text-primary{% else %}text-muted{% endif %}
                                        font-weight-bold
                                    ">{{ candidate.final_decision|default:"Pending" }}</span>
                                </td>
                                <td>â‚¹{{ candidate.final_salary|floatformat:2|default:"N/A" }}</td>
                                <td>
                                    {# Link to the individual interview status/detail page #}
                                    <a href="{% url 'interview_status' candidate_id=candidate.id %}" class="btn btn-info btn-sm" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    {# Add other action buttons if needed, e.g., edit, delete #}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No candidate records found. Analyze a resume to add one!</p>
            <!-- <a href="{% url 'resume_analysis' %}" class="btn btn-info">Go to Resume Analysis</a> -->
        {% endif %}
        {# IMPORTANT: No {% endwith %} tag here. The scope of {% with %} extends to the end of the block. #}
    </div>
{% endblock %}
<style>
    /* Custom styles for the DataTables table if needed */
#candidateRecordsTable {
    width: 100% !important; /* Ensure table takes full width of its container */
    margin-top: 20px; /* Space above the table */
}

/* Adjust padding/margins for DataTables elements if they clash with Bootstrap */
.dataTables_wrapper .dataTables_filter {
    margin-bottom: 15px; /* Space below search box */
}

.dataTables_wrapper .dataTables_length {
    margin-bottom: 15px; /* Space below "Show entries" dropdown */
}

/* Styling for action buttons in the table */
.table td .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.5;
    border-radius: 0.2rem;
}

/* Recommendation and Decision text styling */
.text-success { color: #28a745 !important; } /* Green for Hire/Selected */
.text-danger { color: #dc3545 !important; } /* Red for Reject */
.text-warning { color: #ffc107 !important; } /* Amber for Consider */
.text-primary { color: #007bff !important; } /* Blue for Interview Scheduled */
.text-muted { color: #6c757d !important; } /* For 'Pending' final decision or generic text */
.font-weight-bold { font-weight: bold !important; }

/* Adjust card padding for the records page */
.card.p-4 {
    padding: 1.5rem !important; /* Standard Bootstrap padding for cards */
}

/* Ensure icons in headers are aligned (if used) */
.card-title .fas {
    vertical-align: middle;
}

/* General Layout and containers (from previous code, ensure these are present in your style.css) */
body {
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f4f7f6; /* Light grey background */
    color: #333;
}

/* Ensure your base.html provides necessary main content wrappers and headings */
.page-heading {
    font-size: 2.2em;
    color: #343a40;
    margin-bottom: 25px;
    text-align: center;
    padding-top: 20px;
}

.content-wrapper {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}
</style>
{% block extra_js %}
{# Load jQuery (DataTables dependency) and DataTables JS/CSS #}
{% load static %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize DataTables
        $('#candidateRecordsTable').DataTable({
            "paging": true,       // Enable pagination
            "searching": true,    // Enable search box
            "ordering": true,     // Enable column sorting
            "info": true,         // Show "Showing X to Y of Z entries" info
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]], // Rows per page options
            "language": {
                "search": "Search records:", // Custom search label
                "lengthMenu": "Show _MENU_ entries" // Custom length menu label
            },
            "columnDefs": [
                { "orderable": false, "targets": [7] }, // Disable sorting on the Actions column (index 7)
                { "searchable": false, "targets": [7] }  // Disable searching on the Actions column
            ]
        });
    });
</script>
{% endblock %}

{% block extra_head %}
{# Optional: Add Font Awesome if not already in base.html. If already in base.html, this block can be removed. #}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}