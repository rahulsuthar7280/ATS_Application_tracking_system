{% extends 'base.html' %}

{% block title %}HR Talent Scout Dashboard{% endblock %}

{% block content %}
<style>
    /* A more vibrant, professional color palette */
    :root {
        --primary-main: #6a11cb; /* A deep purple */
        --primary-gradient: linear-gradient(45deg, #6a11cb 0%, #2575fc 100%); /* Purple to blue gradient */

        --text-dark-main: #212529; /* A classic dark text */
        --text-muted: #6c757d;
        --text-light: #f8f9fa;

        --background-page: #f0f2f5; /* A very light, soft gray */
        --card-bg: #ffffff;
        --border-color: #e9ecef;

        /* Enhanced Shadows */
        --shadow-sm: 0 2px 4px rgba(0, 0, 0, .08);
        --shadow-md: 0 8px 16px rgba(0, 0, 0, .15);

        /* More saturated status colors */
        --success-main: #28a745;
        --success-light: #d4edda;
        --warning-main: #ffc107;
        --warning-light: #fff3cd;
        --danger-main: #dc3545;
        --danger-light: #f8d7da;
        --info-main: #17a2b8;
        --info-light: #d1ecf1;

        /* Chart Colors - A vibrant, distinct set */
        --chart-color-1: #36a2eb; /* Blue */
        --chart-color-2: #ff6384; /* Red */
        --chart-color-3: #4bc0c0; /* Teal */
        --chart-color-4: #ff9f40; /* Orange */
        --chart-color-5: #9966ff; /* Purple */
        --chart-color-6: #ffcd56; /* Yellow */
        --chart-color-7: #c9cbcf; /* Gray */
    }

    html, body {
        font-family: 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--background-page);
        color: var(--text-dark-main);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .dashboard-container {
        max-width: 1600px;
        margin-left: auto;
        margin-right: auto;
    }

    .full-width-header {
        margin-top: -50px;
        margin-left: -50px;
        margin-right: -16px;
        padding-top: 1rem;
        padding-bottom: 1rem;
    }

    .dashboard-gradient-bg {
        background: var(--primary-gradient);
    }

    /* Card Styling */
    .card {
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        background-color: var(--card-bg);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow-sm); /* Default subtle shadow */
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
    }

    .dashboard-metric-card .card-body,
    .dashboard-chart-card .card-body {
        padding: 1.5rem;
    }

    /* Metric Icon Circles with Gradient */
    .metric-icon-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        color: var(--text-white-75);
        background: var(--primary-gradient);
        transition: transform 0.3s ease-in-out;
    }
    
    .card:hover .metric-icon-circle {
        transform: scale(1.1);
    }

    /* Status-specific metric card icons */
    .metric-icon-circle.bg-success-light { background: linear-gradient(45deg, #28a745, #20c997); }
    .metric-icon-circle.bg-info-light { background: linear-gradient(45deg, #17a2b8, #00bfff); }
    .metric-icon-circle.bg-warning-light { background: linear-gradient(45deg, #ffc107, #ff9f40); }
    .metric-icon-circle.bg-danger-light { background: linear-gradient(45deg, #dc3545, #e83e8c); }

    /* Chart Card Specifics */
    .dashboard-chart-card .card-header {
        border-bottom: 1px solid var(--border-color);
    }
    .dashboard-chart-card .card-footer {
        border-top: 1px solid var(--border-color);
    }

    /* Progress Bar */
    .progress {
        height: 10px;
        background-color: var(--border-color);
        border-radius: 5px;
    }
    .progress-bar {
        background-color: var(--primary-main);
    }

    /* Table Styling */
    .table-responsive {
        border-radius: 1rem;
        overflow: hidden;
    }

    .table {
        border-collapse: separate;
        border-spacing: 0 0.75rem;
    }
    
    .table th {
        border: none;
        padding-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text-muted);
    }
    
    .table td {
        background-color: var(--background-page);
        border: none;
        padding: 1rem 1.5rem;
        vertical-align: middle;
        border-radius: 0.75rem;
        transition: background-color 0.2s ease;
    }
    
    .table tbody tr:hover td {
        background-color: #e2e6ea;
    }

    /* Text Colors & Utility Classes */
    .text-dark-main { color: var(--text-dark-main) !important; }
    .text-muted-dark { color: var(--text-muted) !important; }
    .text-primary-main { color: var(--primary-main) !important; }
    .text-success-main { color: var(--success-main) !important; }
    .text-warning-main { color: var(--warning-main) !important; }
    .text-danger-main { color: var(--danger-main) !important; }
    .text-info-main { color: var(--info-main) !important; }
    .text-white-75 { color: #fff !important; }

    /* Background Colors */
    .bg-success-light { background-color: var(--success-light) !important; }
    .bg-info-light { background-color: var(--info-light) !important; }
    .bg-warning-light { background-color: var(--warning-light) !important; }
    .bg-danger-light { background-color: var(--danger-light) !important; }

    /* Mobile Styles */
    @media (max-width: 767px) {
        .page-title {
            font-size: 1.5rem;
        }
    }
</style>

<div class="container-fluid dashboard-container py-5">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 mb-5">
        <div class="col">
            <div class="card h-100 dashboard-metric-card border-0 rounded-4">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="metric-icon-circle bg-success-light me-4">
                        <i class="bi bi-people-fill"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="card-title fw-bold mb-1 text-dark-main">{{ total_candidates|default:1200 }}</h3>
                        <p class="text-muted-dark mb-0">Total Candidates</p>
                        <p class="metric-change text-success-main small mt-2 mb-0 fw-semibold">+{{ total_candidates_change|default:55 }}% than last week</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card h-100 dashboard-metric-card border-0 rounded-4">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="metric-icon-circle bg-info-light me-4">
                        <i class="bi bi-check-circle-fill"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="card-title fw-bold mb-1 text-dark-main">{{ completed_calls|default:850 }}</h3>
                        <p class="text-muted-dark mb-0">Completed Interviews</p>
                        <p class="metric-change text-info-main small mt-2 mb-0 fw-semibold">+{{ completed_calls_change|default:3 }}% than last week</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card h-100 dashboard-metric-card border-0 rounded-4">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="metric-icon-circle bg-warning-light me-4">
                        <i class="bi bi-hourglass-split"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="card-title fw-bold mb-1 text-dark-main">{{ in_progress_calls|default:300 }}</h3>
                        <p class="text-muted-dark mb-0">Interviews In Progress</p>
                        <p class="metric-change text-danger-main small mt-2 mb-0 fw-semibold">-{{ in_progress_calls_change|default:2 }}% than last week</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card h-100 dashboard-metric-card border-0 rounded-4">
                <div class="card-body p-4 d-flex align-items-center">
                    <div class="metric-icon-circle bg-danger-light me-4">
                        <i class="bi bi-x-circle-fill"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="card-title fw-bold mb-1 text-dark-main">{{ failed_calls|default:70 }}</h3>
                        <p class="text-muted-dark mb-0">Failed Interviews</p>
                        <p class="metric-change text-danger-main small mt-2 mb-0 fw-semibold">+{{ failed_calls_change|default:5 }}% than yesterday</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-12 col-lg-6">
            <div class="card h-100 dashboard-chart-card border-0 rounded-4">
                <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
                    <h5 class="card-title fw-bold mb-0 text-dark-main">Recruiting Funnel</h5>
                    <p class="text-muted-dark small mb-0">Conversion rates at each stage</p>
                </div>
                <div class="card-body p-4">
                    <canvas id="recruitingFunnelChart"></canvas>
                </div>
                <div class="card-footer bg-white border-0 pt-0 px-4 pb-4">
                    <p class="text-muted-dark small mb-0"><i class="bi bi-funnel me-1"></i> Identify bottlenecks in your hiring process</p>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="card h-100 dashboard-chart-card border-0 rounded-4">
                <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
                    <h5 class="card-title fw-bold mb-0 text-dark-main">Candidates by Source</h5>
                    <p class="text-muted-dark small mb-0">Most effective recruiting channels</p>
                </div>
                <div class="card-body p-4 d-flex justify-content-center align-items-center">
                    <canvas id="recruitmentSourceChart"></canvas>
                </div>
                <div class="card-footer bg-white border-0 pt-0 px-4 pb-4">
                    <p class="text-muted-dark small mb-0"><i class="bi bi-share me-1"></i> Optimize your sourcing strategy</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-12 col-lg-6">
            <div class="card h-100 dashboard-chart-card border-0 rounded-4">
                <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
                    <h5 class="card-title fw-bold mb-0 text-dark-main">Recruiting Financials</h5>
                    <p class="text-muted-dark small mb-0">Cost vs. Revenue Impact</p>
                </div>
                <div class="card-body p-4">
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="card-footer bg-white border-0 pt-0 px-4 pb-4">
                    <p class="text-muted-dark small mb-0"><i class="bi bi-currency-dollar me-1"></i> Based on cost-per-hire and total revenue generated</p>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="card h-100 dashboard-chart-card border-0 rounded-4">
                <div class="card-body p-4 text-center d-flex flex-column justify-content-center">
                    <i class="bi bi-graph-up-arrow display-4 text-primary-main mb-3"></i>
                    <h5 class="card-title fw-bold mb-1 text-dark-main">Overall Financial Health</h5>
                    <p class="text-muted-dark mb-2">Cost per hire: <span class="fw-bold text-danger-main">{{ cost_per_hire|default:"$1,500" }}</span></p>
                    <p class="text-muted-dark mb-2">Total Revenue Impact: <span class="fw-bold text-success-main">{{ total_revenue_impact|default:"$2.5M" }}</span></p>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p class="metric-change text-primary-main small mt-3 mb-0">ROI on Hiring: {{ roi_on_hiring|default:"85%" }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-12 col-lg-6">
            <div class="card h-100 dashboard-chart-card border-0 rounded-4">
                <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
                    <h5 class="card-title fw-bold mb-0 text-dark-main">Open Positions</h5>
                    <p class="text-muted-dark small mb-0">Current vacancies and progress</p>
                </div>
                <div class="card-body p-4">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Job Title</th>
                                    <th scope="col">Department</th>
                                    <th scope="col" class="text-center">Applicants</th>
                                    <th scope="col" class="text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Senior Software Engineer</td>
                                    <td>Engineering</td>
                                    <td class="text-center">150</td>
                                    <td class="text-center"><span class="badge bg-warning-light text-warning-main">Interviewing</span></td>
                                </tr>
                                <tr>
                                    <td>Data Scientist</td>
                                    <td>Data & Analytics</td>
                                    <td class="text-center">85</td>
                                    <td class="text-center"><span class="badge bg-success-light text-success-main">Hiring</span></td>
                                </tr>
                                <tr>
                                    <td>UX/UI Designer</td>
                                    <td>Product</td>
                                    <td class="text-center">110</td>
                                    <td class="text-center"><span class="badge bg-info-light text-info-main">Screening</span></td>
                                </tr>
                                <tr>
                                    <td>HR Manager</td>
                                    <td>Human Resources</td>
                                    <td class="text-center">45</td>
                                    <td class="text-center"><span class="badge bg-warning-light text-warning-main">Interviewing</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="card h-100 dashboard-chart-card border-0 rounded-4">
                <div class="card-header bg-white border-0 pb-0 pt-4 px-4">
                    <h5 class="card-title fw-bold mb-0 text-dark-main">Recent Activity</h5>
                    <p class="text-muted-dark small mb-0">Timeline of latest actions</p>
                </div>
                <div class="card-body p-4">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex align-items-start border-bottom py-3 px-0">
                            <i class="bi bi-person-plus-fill fs-5 text-success-main me-3"></i>
                            <div class="flex-grow-1">
                                <p class="mb-1 fw-bold text-dark-main">New Hire: Jane Doe</p>
                                <p class="mb-0 text-muted-dark small">Accepted offer for Data Scientist position.</p>
                            </div>
                            <span class="text-muted-dark small text-nowrap ms-auto">2 min ago</span>
                        </div>
                        <div class="list-group-item d-flex align-items-start border-bottom py-3 px-0">
                            <i class="bi bi-calendar-check-fill fs-5 text-info-main me-3"></i>
                            <div class="flex-grow-1">
                                <p class="mb-1 fw-bold text-dark-main">Interview Scheduled</p>
                                <p class="mb-0 text-muted-dark small">Scheduled final interview with John Smith for Senior Software Engineer.</p>
                            </div>
                            <span class="text-muted-dark small text-nowrap ms-auto">1 hour ago</span>
                        </div>
                        <div class="list-group-item d-flex align-items-start border-bottom py-3 px-0">
                            <i class="bi bi-file-earmark-text-fill fs-5 text-primary-main me-3"></i>
                            <div class="flex-grow-1">
                                <p class="mb-1 fw-bold text-dark-main">New Application</p>
                                <p class="mb-0 text-muted-dark small">Received 10 new applications for UX/UI Designer role.</p>
                            </div>
                            <span class="text-muted-dark small text-nowrap ms-auto">3 hours ago</span>
                        </div>
                        <div class="list-group-item d-flex align-items-start py-3 px-0">
                            <i class="bi bi-file-x-fill fs-5 text-danger-main me-3"></i>
                            <div class="flex-grow-1">
                                <p class="mb-1 fw-bold text-dark-main">Candidate Rejected</p>
                                <p class="mb-0 text-muted-dark small">Michael Brown rejected for HR Manager role.</p>
                            </div>
                            <span class="text-muted-dark small text-nowrap ms-auto">Yesterday</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        function getCssVar(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }

        const textDarkMain = getCssVar('--text-dark-main');
        const textMuted = getCssVar('--text-muted');
        const borderColor = getCssVar('--border-color');
        
        const chartColors = [
            getCssVar('--chart-color-1'),
            getCssVar('--chart-color-2'),
            getCssVar('--chart-color-3'),
            getCssVar('--chart-color-4'),
            getCssVar('--chart-color-5'),
            getCssVar('--chart-color-6'),
            getCssVar('--chart-color-7')
        ];

        function getDummyChartData(chartType) {
            switch(chartType) {
                case 'recruitingFunnel':
                    return {
                        labels: ['Applicants', 'Screening', 'Interviews', 'Offers', 'Hired'],
                        data: [1000, 750, 400, 150, 50]
                    };
                case 'revenueChart':
                    return {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                        datasets: [
                            {
                                label: 'Cost Per Hire',
                                data: [1500, 1450, 1600, 1350, 1400],
                                borderColor: getCssVar('--danger-main'),
                                backgroundColor: 'rgba(220, 53, 69, 0.2)',
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: getCssVar('--danger-main'),
                                pointRadius: 5,
                                pointHoverRadius: 7
                            },
                            {
                                label: 'Total Revenue Impact ($M)',
                                data: [2.0, 2.1, 2.5, 2.4, 2.6],
                                borderColor: getCssVar('--success-main'),
                                backgroundColor: 'rgba(40, 167, 69, 0.2)',
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: getCssVar('--success-main'),
                                pointRadius: 5,
                                pointHoverRadius: 7
                            }
                        ]
                    };
                case 'recruitmentSource':
                    return {
                        labels: ['LinkedIn', 'Company Website', 'Job Boards', 'Referrals', 'Campus'],
                        data: [40, 25, 15, 10, 10]
                    };
                default:
                    return {labels: [], data: []};
            }
        }

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: textMuted }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: '#4d4d4d',
                    borderWidth: 1,
                    cornerRadius: 8
                }
            },
            scales: {
                y: {
                    grid: { color: borderColor },
                    ticks: { color: textMuted },
                    border: { display: false }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: textMuted },
                    border: { display: false }
                }
            }
        };

        // Chart 1: Recruiting Funnel
        const recruitingFunnelCtx = document.getElementById('recruitingFunnelChart');
        if (recruitingFunnelCtx) {
            const finalFunnelData = getDummyChartData('recruitingFunnel');
            new Chart(recruitingFunnelCtx, {
                type: 'bar',
                data: {
                    labels: finalFunnelData.labels,
                    datasets: [{
                        label: 'Candidates',
                        data: finalFunnelData.data,
                        backgroundColor: chartColors.slice(0, finalFunnelData.labels.length).map(color => color + 'b3'),
                        borderColor: chartColors.slice(0, finalFunnelData.labels.length),
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            ...commonOptions.scales.y,
                            beginAtZero: true
                        },
                        x: commonOptions.scales.x
                    }
                }
            });
        }

        // Chart 2: Revenue Chart
        const revenueCtx = document.getElementById('revenueChart');
        if (revenueCtx) {
            const finalRevenueData = getDummyChartData('revenueChart');
            new Chart(revenueCtx, {
                type: 'line',
                data: finalRevenueData,
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        legend: { position: 'top', labels: { color: textDarkMain } }
                    }
                }
            });
        }

        // Chart 3: Recruitment Source Pie Chart
        const recruitmentSourceCtx = document.getElementById('recruitmentSourceChart');
        if (recruitmentSourceCtx) {
            const finalSourceData = getDummyChartData('recruitmentSource');
            new Chart(recruitmentSourceCtx, {
                type: 'doughnut',
                data: {
                    labels: finalSourceData.labels,
                    datasets: [{
                        label: 'Candidates by Source',
                        data: finalSourceData.data,
                        backgroundColor: chartColors.slice(0, finalSourceData.labels.length),
                        hoverOffset: 8,
                        spacing: 4,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'right',
                            align: 'center',
                            labels: {
                                color: textDarkMain,
                                boxWidth: 12,
                                padding: 20
                            }
                        },
                        tooltip: {
                            ...commonOptions.plugins.tooltip,
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        label += percentage + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    });
</script>
{% endblock %}