{% extends 'base.html' %}

{% block title %}Create Job Description{% endblock %}
{% block page_heading %}Create Job Description{% endblock %}

{% block content %}
<div class="content-wrapper d-flex justify-content-center align-items-center min-vh-100 py-5">
    {# Use a fluid container to allow content to span more width, or no container for full width #}
    <div class="container-fluid"> {# Changed from custom-card div to a fluid container #}
        <div class="card p-5 shadow-lg custom-card mx-auto" style="max-width: 1200px; width: 100%;">
            <h1 class="page-heading text-center mb-4">Create New Job Description</h1>
            <p class="text-center text-muted mb-4">Input the comprehensive details for your IT job description.</p>

            {% if messages %}
                <div class="mb-4">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="post" action="{% url 'create_jd' %}">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="title" class="form-label fw-bold">Job Title <span class="text-danger">*</span></label>
                        <input type="text" class="form-control universal-input" id="title" name="title" required placeholder="e.g., Senior Software Engineer (Python)">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="job_level" class="form-label fw-bold">Job Level</label>
                        <select class="form-select universal-input" id="job_level" name="job_level">
                            <option value="">Select Level</option>
                            <option value="intern">Intern</option>
                            <option value="junior">Junior</option>
                            <option value="mid">Mid-Level</option>
                            <option value="senior">Senior</option>
                            <option value="lead">Lead</option>
                            <option value="manager">Manager</option>
                            <option value="director">Director</option>
                            <option value="vp">Vice President</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="department" class="form-label fw-bold">Department</label>
                        <input type="text" class="form-control universal-input" id="department" name="department" placeholder="e.g., Engineering, Data Science, DevOps">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="company_name" class="form-label fw-bold">Company Name</label>
                        <input type="text" name="company_name" class="form-control universal-input" id="company_name" placeholder="e.g., Tech Solutions Inc." required>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="job_description" class="form-label fw-bold">Job Description</label>
                    <textarea name="job_description" class="form-control universal-textarea" id="job_description" rows="10" placeholder="Provide a detailed description of the job role, responsibilities, and requirements." required></textarea>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="salary_min" class="form-label fw-bold">Salary (Min)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" name="salary_min" class="form-control universal-input" id="salary_min" placeholder="e.g., 50000" aria-label="Minimum salary">
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="salary_max" class="form-label fw-bold">Salary (Max)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" name="salary_max" class="form-control universal-input" id="salary_max" placeholder="e.g., 75000" aria-label="Maximum salary">
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="salary_frequency" class="form-label fw-bold">Salary Frequency</label>
                        <select name="salary_frequency" class="form-select universal-input" id="salary_frequency">
                            <option value="" selected disabled>Select frequency</option>
                            <option value="hourly">Hourly</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="employment_type" class="form-label fw-bold">Employment Type</label>
                    <select class="form-select universal-input" id="employment_type" name="employment_type">
                        <option value="">Select Type</option>
                        <option value="full-time">Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="temporary">Temporary</option>
                        <option value="internship">Internship</option>
                    </select>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="country" class="form-label fw-bold">Country</label>
                        <select name="country" class="form-select universal-input" id="country">
                            <option value="" selected disabled>Select Country</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="state" class="form-label fw-bold">State</label>
                        <select name="state" class="form-select universal-input" id="state" disabled>
                            <option value="" selected disabled>Select State</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="city" class="form-label fw-bold">City</label>
                        <select name="city" class="form-select universal-input" id="city" disabled>
                            <option value="" selected disabled>Select City</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="overview" class="form-label fw-bold">Job Overview</label>
                    <textarea class="form-control universal-textarea" id="overview" name="overview" rows="4" placeholder="Provide a brief overview of the role and its impact within the company."></textarea>
                </div>

                <div class="mb-4">
                    <label for="responsibilities" class="form-label fw-bold">Key Responsibilities</label>
                    <textarea class="form-control universal-textarea" id="responsibilities" name="responsibilities" rows="8" placeholder="List the primary duties and responsibilities, one per line."></textarea>
                </div>

                <div class="mb-4">
                    <label for="required_skills" class="form-label fw-bold">Required Skills & Qualifications</label>
                    <textarea class="form-control universal-textarea" id="required_skills" name="required_skills" rows="6" placeholder="List essential skills and qualifications, e.g., Python, SQL, Cloud Platforms (AWS/Azure/GCP), Agile methodologies."></textarea>
                </div>

                <div class="mb-4">
                    <label for="preferred_skills" class="form-label fw-bold">Preferred Skills</label>
                    <textarea class="form-control universal-textarea" id="preferred_skills" name="preferred_skills" rows="4" placeholder="List desirable but not strictly mandatory skills, e.g., Docker, Kubernetes, Machine Learning frameworks."></textarea>
                </div>

                <div class="mb-4">
                    <label for="education_experience" class="form-label fw-bold">Education & Experience</label>
                    <textarea class="form-control universal-textarea" id="education_experience" name="education_experience" rows="4" placeholder="Specify education requirements (e.g., Bachelor's in CS or related field) and years of experience."></textarea>
                </div>

                <div class="mb-4">
                    <label for="benefits" class="form-label fw-bold">Benefits & Perks</label>
                    <textarea class="form-control universal-textarea" id="benefits" name="benefits" rows="4" placeholder="Describe the benefits offered, e.g., Health insurance, 401k, PTO, professional development opportunities."></textarea>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary enhanced-btn">
                        <i class="fas fa-save me-2"></i>Save Job Description
                    </button>
                    <a href="{% url 'all_job_descriptions' %}" class="btn btn-secondary universal-btn">
                        <i class="fas fa-arrow-left me-2"></i>Back to All JDs
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary-color: #0077b6;
        --secondary-color: #00b4d8;
        --text-color: #333;
        --card-bg: #ffffff;
        --bg-color: #e9f5ff;
        --input-border: #dee2e6;
        --input-focus: #0077b6;
    }
    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
    }
    .page-heading {
        font-size: 2.2rem;
        color: var(--primary-color);
        font-weight: 700;
    }
    .custom-card {
        border-radius: 1.5rem;
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        background-color: var(--card-bg);
        border: none;
    }
    .universal-input, .universal-textarea, .form-select {
        border-radius: 0.75rem;
        border: 1px solid var(--input-border);
        padding: 0.85rem 1.25rem;
        transition: all 0.3s ease;
    }
    .universal-input:focus, .universal-textarea:focus, .form-select:focus {
        border-color: var(--input-focus);
        box-shadow: 0 0 0 0.25rem rgba(0, 119, 182, 0.25);
    }
    .enhanced-btn {
        border: none;
        border-radius: 0.75rem;
        font-weight: 600;
        padding: 0.85rem 2rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
    }
    .enhanced-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 7px 14px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
    }
    .btn-primary {
        background: linear-gradient(45deg, #0d6efd, #0056b3);
        color: white;
    }
    .btn-primary:hover {
        background: linear-gradient(45deg, #0056b3, #003d80);
        color: white;
    }
    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
    }
    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
        color: white;
    }
    .universal-btn {
        font-weight: 600;
        border-radius: 0.75rem;
        padding: 0.85rem 2rem;
    }
    .alert {
        border-radius: 0.75rem;
    }
    label {
        color: #495057;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const countrySelect = document.getElementById('country');
        const stateSelect = document.getElementById('state');
        const citySelect = document.getElementById('city');
        const apiKey = 'YOUR_API_KEY_HERE'; // Replace with your actual API key
        const apiBaseUrl = 'https://api.countrystatecity.in/v1';

        // Set up headers with the API key
        const headers = {
            'X-CSCAPI-KEY': apiKey
        };

        // Function to populate a select element
        const populateDropdown = (selectElement, data, valueKey, textKey) => {
            selectElement.innerHTML = '<option value="" selected disabled>Select...</option>';
            data.forEach(item => {
                let option = new Option(item[textKey], item[valueKey]);
                selectElement.add(option);
            });
            selectElement.disabled = false;
        };

        // Fetch countries
        const fetchCountries = async () => {
            try {
                const response = await fetch(`${apiBaseUrl}/countries`, { headers });
                const data = await response.json();
                populateDropdown(countrySelect, data, 'iso2', 'name');
            } catch (error) {
                console.error('Error fetching countries:', error);
                // Handle error gracefully, maybe show a message to the user
            }
        };

        // Fetch states for a given country
        const fetchStates = async (countryCode) => {
            try {
                const response = await fetch(`${apiBaseUrl}/countries/${countryCode}/states`, { headers });
                const data = await response.json();
                populateDropdown(stateSelect, data, 'iso2', 'name');
            } catch (error) {
                console.error('Error fetching states:', error);
            }
        };

        // Fetch cities for a given country and state
        const fetchCities = async (countryCode, stateCode) => {
            try {
                const response = await fetch(`${apiBaseUrl}/countries/${countryCode}/states/${stateCode}/cities`, { headers });
                const data = await response.json();
                populateDropdown(citySelect, data, 'name', 'name');
            } catch (error) {
                console.error('Error fetching cities:', error);
            }
        };

        // Event listeners
        countrySelect.addEventListener('change', function() {
            stateSelect.innerHTML = '<option value="" selected disabled>Select State</option>';
            citySelect.innerHTML = '<option value="" selected disabled>Select City</option>';
            stateSelect.disabled = true;
            citySelect.disabled = true;
            
            const selectedCountryCode = this.value;
            if (selectedCountryCode) {
                fetchStates(selectedCountryCode);
            }
        });

        stateSelect.addEventListener('change', function() {
            citySelect.innerHTML = '<option value="" selected disabled>Select City</option>';
            citySelect.disabled = true;

            const selectedCountryCode = countrySelect.value;
            const selectedStateCode = this.value;
            if (selectedCountryCode && selectedStateCode) {
                fetchCities(selectedCountryCode, selectedStateCode);
            }
        });

        // Initial call to fetch countries on page load
        fetchCountries();
    });
</script>
{% endblock %}